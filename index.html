<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Ø§Ù„Ø´ÙŠØ® Ù…ÙˆØ³Ù‰ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠÙ„Ø©</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet" />
  
  <style>
    /* === Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© === */
    :root {
      --bg-dark: #050505;
      --panel-dark: rgba(20, 20, 20, 0.7); /* Ø´ÙØ§ÙÙŠØ© Ù„Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
      --panel-hover: #1a1a1a;
      --gold: #d4af37;
      --gold-dim: #a68a2d;
      --gold-glow: rgba(212, 175, 55, 0.3);
      --text: #ffffff;
      --danger: #ff4d4d;
      --success: #2ecc71;
    }
    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: "Cairo", sans-serif; margin: 0; background: var(--bg-dark);
      color: var(--text); overflow-x: hidden; line-height: 1.6;
      background-image: radial-gradient(circle at 50% 0%, #1a1a1a 0%, var(--bg-dark) 80%);
    }
    
    /* === Ø§Ù„ØªØ­Ø±ÙƒØ§Øª === */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0% { background: #1a1a1a; } 50% { background: #252525; } 100% { background: #1a1a1a; } }
    
    /* === Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª === */
    .btn {
      background: linear-gradient(45deg, var(--gold), #b89326); color: #000; border: none; padding: 10px 20px;
      border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 0 15px var(--gold-glow); }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-danger:hover { background: #d63030; }
    
    input, textarea {
      width: 100%; background: rgba(30, 30, 30, 0.8); border: 1px solid #333; padding: 12px;
      border-radius: 8px; color: #fff; margin-bottom: 10px; font-family: inherit;
    }
    input:focus, textarea:focus { border-color: var(--gold); }

    /* === Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Toast) === */
    #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 20000; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 400px; pointer-events: none; }
    .toast {
      background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(5px); border-right: 4px solid var(--gold); color: #fff;
      padding: 15px; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.5);
      animation: fadeIn 0.3s forwards; pointer-events: auto; text-align: right; border-left: none;
    }
    .toast.success { border-color: var(--success); } .toast.error { border-color: var(--danger); }

    /* === Ø§Ù„Ù‡ÙŠØ¯Ø± === */
    .hero {
      height: 35vh; min-height: 280px; text-align: center; display: flex; flex-direction: column;
      align-items: center; justify-content: center; position: relative;
      background: url("https://yt3.googleusercontent.com/VLV8GQTdrlLUeXvglIV6OS7YXYfyY3CfyfK3TOt5gIeUyKiXigdFFXYtR1WLaCAaL4xzDUIuYA=w1707-fcrop64=1,00005a57ffffa5a8-k-c0xffffffff-no-nd-rj") center/cover no-repeat fixed;
    }
    .hero::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(5,5,5,0.4), var(--bg-dark)); }
    .hero-content { position: relative; z-index: 10; animation: fadeIn 0.8s; }
    .logo { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--gold); box-shadow: 0 0 20px var(--gold-glow); margin-bottom: 10px; }
    .hero h1 { color: var(--gold); font-size: 2.2rem; margin: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }

    /* === Ø§Ù„ØªÙ†Ù‚Ù„ === */
    .navbar {
      position: sticky; top: 0; z-index: 1000; 
      background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(12px); /* Ø²Ø¬Ø§Ø¬ÙŠ */
      border-bottom: 1px solid rgba(255,255,255,0.05); padding: 10px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;
    }
    .nav-btn {
      background: transparent; color: #bbb; border: none; padding: 8px 15px;
      font-weight: 600; cursor: pointer; border-radius: 20px; transition: 0.3s;
    }
    .nav-btn.active, .nav-btn:hover { background: rgba(212, 175, 55, 0.15); color: var(--gold); }

    /* === Ø§Ù„Ù…Ø­ØªÙˆÙ‰ === */
    main { padding: 20px; max-width: 1200px; margin: 0 auto; min-height: 50vh; }
    .page { display: none; animation: fadeIn 0.4s; } .page.visible { display: block; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    
    .card { 
      background: var(--panel-dark); backdrop-filter: blur(5px);
      border: 1px solid #222; border-radius: 12px; overflow: hidden; transition: 0.3s; 
    }
    .card:hover { transform: translateY(-5px); border-color: var(--gold-dim); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .card-content { padding: 15px; }
    .card-title { font-size: 1.1rem; margin: 0 0 10px; font-weight: 600; color: #eee; }
    .video-thumb { width: 100%; height: 180px; object-fit: cover; }

    .upload-box { background: rgba(20,20,20,0.6); border: 1px dashed #444; padding: 20px; border-radius: 12px; margin-bottom: 30px; text-align: center; max-width: 600px; margin-inline: auto; }
    
    /* === Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© === */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; align-items: center; justify-content: center; visibility: hidden; opacity: 0; transition: 0.3s; }
    .modal-overlay.active { visibility: visible; opacity: 1; }
    .modal-box { 
      background: rgba(26, 26, 26, 0.95); backdrop-filter: blur(10px);
      padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; border: 1px solid var(--gold); text-align: center; 
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
    .admin-float-btn {
      position: fixed; right: 15px; width: 40px; height: 40px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 2000;
      border: 1px solid var(--gold); background: rgba(0,0,0,0.6); color: var(--gold); backdrop-filter: blur(4px);
      transition: 0.3s;
    }
    #admin-toggle { top: 15px; }
    #maint-toggle { top: 65px; border-color: var(--danger); color: var(--danger); display: none; } /* ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø· */
    
    /* Ø´Ø§Ø´Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© */
    #maintenance-overlay {
      position: fixed; inset: 0; background: #080808; z-index: 15000;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; padding: 20px;
    }

    footer { text-align: center; padding: 40px; border-top: 1px solid #222; color: #666; margin-top: 50px; }
    .social-btn { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: #222; color: #fff; text-decoration: none; border-radius: 20px; margin: 5px; }
    .social-btn.tg { color: #0088cc; } .social-btn.wa { color: #25d366; }
    
    .skeleton { background: #222; height: 200px; border-radius: 12px; animation: pulse 1.5s infinite; }
  </style>
</head>
<body>

  <div id="toast-container"></div>

  <div id="maintenance-overlay" style="display: none;">
    <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ› ï¸</div>
    <h1 style="color: var(--danger); margin: 0 0 10px;">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©</h1>
    <p style="color: #aaa; font-size: 1.1rem; max-width: 500px; margin: 0 auto;">
      Ù†Ù‚ÙˆÙ… Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª. Ø³Ù†Ø¹ÙˆØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¬Ø¯Ø§Ù‹.
    </p>
    <button id="force-enter-btn" style="margin-top: 30px; background: #222; color: #666; border: 1px solid #333; padding: 5px 15px; border-radius: 5px; cursor: pointer;">
      Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù
    </button>
  </div>

  <div id="welcome-overlay" class="modal-overlay active">
    <div class="modal-box">
      <h3 style="color:#fff">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´ÙŠØ®</h3>
      <h1 style="color:var(--gold)">Ù…ÙˆØ³Ù‰ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠÙ„Ø©</h1>
      <p style="color:#aaa">ØµÙ„ÙÙ‘ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¨ÙŠØ¨ Ø§Ù„Ù…ØµØ·ÙÙ‰ ï·º</p>
      <button class="btn" onclick="enterSite()">Ø§Ù„Ù„Ù‡Ù… ØµÙ„ÙÙ‘ ÙˆØ³Ù„Ù… Ø¹Ù„ÙŠÙ‡ (Ø¯Ø®ÙˆÙ„)</button>
    </div>
  </div>

  <div id="login-modal" class="modal-overlay">
    <div class="modal-box">
      <h3 style="color:var(--gold)">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø´Ø±Ù</h3>
      <form id="login-form">
        <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
        <div style="display: flex; gap: 10px; margin-top: 15px;">
          <button type="submit" class="btn" style="flex:1">Ø¯Ø®ÙˆÙ„</button>
          <button type="button" class="btn btn-danger" onclick="toggleModal('login-modal', false)">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </form>
    </div>
  </div>

  <button id="admin-toggle" class="admin-float-btn" onclick="handleAdminClick()" title="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">âš™ï¸</button>
  <button id="maint-toggle" class="admin-float-btn" onclick="toggleMaintenance()" title="ØªØºÙŠÙŠØ± ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©">ğŸ› ï¸</button>

  <header class="hero">
    <div class="hero-content">
      <img src="https://yt3.googleusercontent.com/co-iJ8X1CeyQWoeqU8TspcCyVNY_pPLZTP_LHpEPi73b39Pql8nAXpObTgl1Qs2Cle6IorGSyA=s160-c-k-c0x00ffffff-no-rj" class="logo">
      <h1>Ø§Ù„Ø´ÙŠØ® Ù…ÙˆØ³Ù‰ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠÙ„Ø©</h1>
      <p>Ù…Ù†Ø¨Ø± Ø¹Ù„Ù… ÙˆØ®ÙŠØ± ÙˆÙ†ÙˆØ± ğŸŒ™</p>
    </div>
  </header>

  <nav class="navbar">
    <button class="nav-btn active" onclick="switchPage('videos', this)">ğŸ“º Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button>
    <button class="nav-btn" onclick="switchPage('books', this)">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø©</button>
    <button class="nav-btn" onclick="switchPage('tips', this)">ğŸŒ¿ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª</button>
    <button class="nav-btn" onclick="switchPage('posts', this)">âœï¸ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</button>
  </nav>

  <main>
    <section id="videos-page" class="page visible">
      <div style="text-align:center; margin-bottom:20px; color:var(--gold)">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø±Ø¦ÙŠØ§Øª Ù…Ù† Ø§Ù„Ù‚Ù†Ø§Ø©</div>
      <div id="videos-grid" class="grid">
        <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
      </div>
    </section>

    <section id="books-page" class="page">
      <form id="book-form" class="upload-box" style="display: none;">
        <h4 style="color:var(--gold); margin-top:0">Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯</h4>
        <input type="text" name="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨" required>
        <input type="url" name="url" placeholder="Ø±Ø§Ø¨Ø· Google Drive" required>
        <button type="submit" class="btn">Ù†Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨</button>
      </form>
      <div id="books-grid" class="grid"></div>
    </section>

    <section id="tips-page" class="page">
      <form id="tip-form" class="upload-box" style="display: none;">
        <h4 style="color:var(--gold); margin-top:0">Ø¥Ø¶Ø§ÙØ© Ø¥Ø±Ø´Ø§Ø¯ Ø¬Ø¯ÙŠØ¯</h4>
        <textarea name="text" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..." required></textarea>
        <button type="submit" class="btn">Ù†Ø´Ø± Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯</button>
      </form>
      <div id="tips-grid" class="grid"></div>
    </section>

    <section id="posts-page" class="page">
      <form id="post-form" class="upload-box" style="display: none;">
        <h4 style="color:var(--gold); margin-top:0">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</h4>
        <input type="text" name="title" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required>
        <textarea name="description" rows="2" placeholder="Ø§Ù„ÙˆØµÙ..."></textarea>
        <div style="background:#222; padding:10px; border-radius:8px; margin-bottom:10px; text-align:right">
          <label style="font-size:0.9rem; color:#aaa">ÙÙŠØ¯ÙŠÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
          <input type="file" name="videoFile" accept="video/*" style="margin-top:5px">
        </div>
        <button type="submit" class="btn">Ø±ÙØ¹ ÙˆÙ†Ø´Ø±</button>
      </form>
      <div id="posts-grid" class="grid"></div>
    </section>
  </main>

  <footer>
    <div style="margin-bottom: 20px;">
      <a href="https://t.me/musaahmadkh" target="_blank" class="social-btn tg">Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…</a>
      <a href="https://chat.whatsapp.com/JaAji0WfEat8dVI1CPB4c1" target="_blank" class="social-btn wa">Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</a>
    </div>
    <div id="admin-actions" style="display: none;">
      <button class="btn btn-danger" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø´Ø±Ù</button>
      <button class="btn" onclick="changePass()">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
    </div>
    <p>Â© 2025 Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´ÙŠØ® Ù…ÙˆØ³Ù‰ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠÙ„Ø©</p>
  </footer>

  <script>
    const CONFIG = {
      // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø±Ø§Ø¨Ø· Ø³ÙŠØ±ÙØ±Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Render
      BACKEND: "https://mosa-backend-dr63.onrender.com", 
      CLOUDINARY: { CLOUD_NAME: "dkdnq0zj3", PRESET: "unsigned_posts_preset" },
      YOUTUBE: "UChFRy4s3_0MVJ3Hmw2AMcoQ"
    };

    let state = { adminPass: sessionStorage.getItem("adminPass") };
    let isMaintenance = false;

    // --- Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ---
    (async function init() {
      await checkMaintenance(); // ÙØ­Øµ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø£ÙˆÙ„Ø§Ù‹
      loadContent();
    })();

    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„ØªØ±Ø­ÙŠØ¨ ---
    async function checkMaintenance() {
      try {
        const res = await fetch(`${CONFIG.BACKEND}/config/status`);
        const data = await res.json();
        isMaintenance = data.maintenance;

        const maintOverlay = document.getElementById("maintenance-overlay");
        const welcomeOverlay = document.getElementById("welcome-overlay");

        if (isMaintenance) {
          // Ø§Ù„ØµÙŠØ§Ù†Ø© Ù…ÙØ¹Ù„Ø©: Ø£Ø¸Ù‡Ø± Ø´Ø§Ø´Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©ØŒ ÙˆØ£Ø®Ù Ø§Ù„ØªØ±Ø­ÙŠØ¨
          maintOverlay.style.display = "flex";
          welcomeOverlay.style.display = "none";
          welcomeOverlay.classList.remove('active');
        } else {
          // Ø§Ù„ØµÙŠØ§Ù†Ø© ØºÙŠØ± Ù…ÙØ¹Ù„Ø©
          maintOverlay.style.display = "none";
          // Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙŠØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ø¨Ø± HTML class active
        }
      } catch (e) { console.error("Error fetching maintenance status"); }
    }

    // Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙŠØ§Ù†Ø© (Ù„Ù„Ù…Ø´Ø±Ù)
    async function toggleMaintenance() {
      if(!state.adminPass) return;
      const newState = !isMaintenance;
      const msg = newState ? 
        "ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŸ (Ø³ÙŠØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ù…Ø§Ù… Ø§Ù„Ø²ÙˆØ§Ø±)" : 
        "Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŸ";
      
      if(!confirm(msg)) return;

      try {
        const res = await api('/config/maintenance', 'POST', { status: newState });
        showToast(res.message);
        isMaintenance = newState;
        updateUI(); // Ù„ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„Ø²Ø±
      } catch (e) {}
    }

    // Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù„Ù„Ù…Ø´Ø±Ù Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØµÙŠØ§Ù†Ø©
    document.getElementById("force-enter-btn").onclick = () => {
      document.getElementById("maintenance-overlay").style.display = "none";
      toggleModal('login-modal', true);
    };

    // --- Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---
    function enterSite() {
      document.getElementById('welcome-overlay').classList.remove('active');
    }

    function showToast(msg, type='success') {
      const box = document.createElement('div');
      box.className = `toast ${type}`;
      box.innerText = msg;
      document.getElementById('toast-container').appendChild(box);
      setTimeout(() => box.remove(), 3000);
    }

    async function api(url, method="GET", body=null) {
      const headers = { "Content-Type": "application/json" };
      if (state.adminPass) headers["x-admin-pass"] = state.adminPass;
      try {
        const res = await fetch(CONFIG.BACKEND + url, { method, headers, body: body ? JSON.stringify(body) : null });
        const data = await res.json();
        if (!res.ok) throw new Error(data.message || "Ø­Ø¯Ø« Ø®Ø·Ø£");
        return data;
      } catch (err) {
        showToast(err.message, 'error');
        throw err;
      }
    }

    function loadContent() {
      checkAdmin();
      loadVideos();
      loadBooks();
      loadTips();
      loadPosts();
    }

    // --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù†ÙØ³ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©) ---
    async function loadVideos() {
      const container = document.getElementById("videos-grid");
      try {
        // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø«Ø¨Ø§Øª
        const proxyRes = await fetch(`${CONFIG.BACKEND}/youtube-feed?channelId=${CONFIG.YOUTUBE}`);
        if(proxyRes.ok){
             const text = await proxyRes.text();
             const parser = new DOMParser();
             const xml = parser.parseFromString(text, "text/xml");
             const items = Array.from(xml.querySelectorAll("entry")).slice(0, 30).map(e => ({
                title: e.querySelector("title").textContent,
                guid: e.querySelector("videoId").textContent
             }));
             
             container.innerHTML = items.map(v => `
             <div class="card">
               <a href="https://www.youtube.com/watch?v=${v.guid}" target="_blank">
                 <img src="https://img.youtube.com/vi/${v.guid}/hqdefault.jpg" class="video-thumb" loading="lazy">
               </a>
               <div class="card-content">
                 <p class="card-title">${v.title}</p>
               </div>
             </div>`).join('');
        } else {
             throw new Error("Proxy failed");
        }
      } catch (e) { container.innerHTML = "<p style='text-align:center;width:100%'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª...</p>"; }
    }

    async function loadBooks() {
      try {
        const res = await api('/books');
        document.getElementById('books-grid').innerHTML = res.data.map(b => {
          const fileId = b.url.match(/\/d\/([^/]+)/)?.[1];
          return `
          <div class="card">
            <div style="height:180px; background:rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center; overflow:hidden">
              ${fileId ? `<iframe src="https://drive.google.com/file/d/${fileId}/preview" style="width:100%;height:100%;border:none;pointer-events:none"></iframe>` : 'ğŸ“š'}
            </div>
            <div class="card-content">
              <h3 class="card-title">${b.title}</h3>
              <div style="display:flex; gap:5px">
                <a href="${b.url}" target="_blank" class="btn" style="flex:1;text-align:center">Ù‚Ø±Ø§Ø¡Ø©</a>
                ${state.adminPass ? `<button onclick="del('books','${b.id || b._id}')" class="btn btn-danger">Ø­Ø°Ù</button>` : ''}
              </div>
            </div>
          </div>`;
        }).join('');
      } catch(e){}
    }

    async function loadTips() {
      try {
        const res = await api('/tips');
        document.getElementById('tips-grid').innerHTML = res.data.map(t => `
        <div class="card" style="border-right:4px solid var(--gold)">
          <div class="card-content">
            <p style="white-space:pre-wrap">${t.text}</p>
            ${state.adminPass ? `
            <div style="margin-top:10px; display:flex; gap:5px; justify-content:flex-end">
               <button onclick="editTip('${t.id || t._id}', '${t.text.replace(/\n/g,'\\n').replace(/'/g, "\\'")}')" class="btn">ØªØ¹Ø¯ÙŠÙ„</button>
               <button onclick="del('tips','${t.id || t._id}')" class="btn btn-danger">Ø­Ø°Ù</button>
            </div>` : ''}
          </div>
        </div>`).join('');
      } catch(e){}
    }

    async function loadPosts() {
      try {
        const res = await api('/posts');
        document.getElementById('posts-grid').innerHTML = res.data.map(p => `
        <div class="card">
          ${p.videoUrl ? `<video controls src="${p.videoUrl}" style="width:100%;height:200px;background:#000"></video>` : ''}
          <div class="card-content">
            <h3 class="card-title">${p.title}</h3>
            <p style="color:#ccc; font-size:0.9rem; white-space:pre-wrap">${p.description}</p>
            ${state.adminPass ? `<button onclick="del('posts','${p.id || p._id}')" class="btn btn-danger" style="width:100%;margin-top:10px">Ø­Ø°Ù</button>` : ''}
          </div>
        </div>`).join('');
      } catch(e){}
    }

    // --- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
    function handleAdminClick() {
      state.adminPass ? (confirm("ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ØŸ") && logout()) : toggleModal('login-modal', true);
    }
    function toggleModal(id, show) {
      document.getElementById(id).classList.toggle('active', show);
    }

    document.getElementById('login-form').onsubmit = async (e) => {
      e.preventDefault();
      const u = document.getElementById('username').value;
      const p = document.getElementById('password').value;
      if (u !== "sayafbadarin") return showToast("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø®Ø·Ø£", "error");
      
      try {
        await api('/books', 'GET'); // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        state.adminPass = p;
        sessionStorage.setItem("adminPass", p);
        
        checkAdmin();
        toggleModal('login-modal', false);
        showToast("ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");
        loadContent(); 
      } catch(e) {
        showToast("ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±)", "error");
        state.adminPass = null;
      }
    };

    function checkAdmin() {
      const isAdmin = !!state.adminPass;
      // ØªÙ„ÙˆÙŠÙ† Ø²Ø± Ø§Ù„Ø§Ø¯Ø§Ø±Ø©
      document.getElementById('admin-toggle').style.background = isAdmin ? 'var(--gold)' : 'rgba(0,0,0,0.6)';
      document.getElementById('admin-toggle').style.color = isAdmin ? '#000' : 'var(--gold)';
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØµÙŠØ§Ù†Ø© Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·
      const maintBtn = document.getElementById('maint-toggle');
      maintBtn.style.display = isAdmin ? 'flex' : 'none';
      maintBtn.style.background = isMaintenance ? 'var(--danger)' : 'rgba(0,0,0,0.6)';
      maintBtn.style.color = isMaintenance ? '#fff' : 'var(--danger)';

      document.querySelectorAll('.upload-box').forEach(e => e.style.display = isAdmin ? 'block' : 'none');
      document.getElementById('admin-actions').style.display = isAdmin ? 'block' : 'none';
    }

    function logout() {
      sessionStorage.clear(); state.adminPass = null;
      checkAdmin(); showToast("ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬"); location.reload();
    }

    function updateUI() {
        checkAdmin();
    }

    // --- Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø°Ù ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ© ---
    async function del(type, id) {
      if(confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) {
        await api(`/${type}/${id}`, 'DELETE');
        showToast("ØªÙ… Ø§Ù„Ø­Ø°Ù");
        if(type=='books') loadBooks(); if(type=='tips') loadTips(); if(type=='posts') loadPosts();
      }
    }
    
    document.getElementById('book-form').onsubmit = async (e) => {
      e.preventDefault();
      await api('/books', 'POST', { title: e.target.title.value, url: e.target.url.value });
      showToast("ØªÙ…"); e.target.reset(); loadBooks();
    };

    document.getElementById('tip-form').onsubmit = async (e) => {
      e.preventDefault();
      await api('/tips', 'POST', { text: e.target.text.value });
      showToast("ØªÙ…"); e.target.reset(); loadTips();
    };

    document.getElementById('post-form').onsubmit = async (e) => {
      e.preventDefault();
      const btn = e.target.querySelector('button');
      btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹..."; btn.disabled = true;
      try {
        let videoUrl = "";
        const file = e.target.videoFile.files[0];
        if (file) {
          const fd = new FormData(); fd.append("file", file); fd.append("upload_preset", CONFIG.CLOUDINARY.PRESET);
          const res = await fetch(`https://api.cloudinary.com/v1_1/${CONFIG.CLOUDINARY.CLOUD_NAME}/upload`, { method:"POST", body:fd });
          const data = await res.json();
          videoUrl = data.secure_url;
        }
        await api('/posts', 'POST', { title: e.target.title.value, description: e.target.description.value, videoUrl });
        showToast("ØªÙ… Ø§Ù„Ù†Ø´Ø±"); e.target.reset(); loadPosts();
      } catch(err) { showToast("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹", "error"); }
      btn.innerText = "Ø±ÙØ¹ ÙˆÙ†Ø´Ø±"; btn.disabled = false;
    };
    
    // ØªÙ†Ù‚Ù„ Ø§Ù„ØµÙØ­Ø§Øª
    window.switchPage = (id, btn) => {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('visible'));
      document.getElementById(id+'-page').classList.add('visible');
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    };
    
    window.changePass = async () => {
      const n = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø£ÙƒØ«Ø± Ù…Ù† 4 Ø­Ø±ÙˆÙ):");
      if(n) { await api('/admin/change-password', 'POST', {newPassword:n}); showToast("ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±"); }
    };
  </script>
</body>
</html>
